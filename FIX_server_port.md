# Fix Applied: Missing server_port Configuration

## Problem
When running the network tax experiment, STGen was failing with:
```
ValueError: Missing required fields: ['server_port']
```

## Root Cause
The configuration generated by the experiment scripts was missing the `server_port` field, which is required by STGen's configuration validator.

## Solution
Added protocol-specific default ports to both experiment scripts:

```python
# Protocol-specific default ports
port_map = {
    "mqtt": 1883,      # Standard MQTT port
    "coap": 5683,      # Standard CoAP port
    "custom_udp": 5000,# Custom UDP port
    "srtp": 5004       # Standard RTP port
}

stgen_config = {
    "protocol": self.protocol,
    "mode": "active",
    "server_ip": "127.0.0.1",
    "server_port": port_map.get(self.protocol, 5000),  # Added this line
    "num_clients": self.num_sensors,
    "duration": self.duration,
    # ... rest of config
}
```

## Files Modified
1. `run_network_tax_single_device.py` - Single-device experiment
2. `run_network_tax_experiment.py` - Distributed experiment

## How to Run Now

### Quick Test (30 seconds, 100 sensors)
```bash
source myenv/bin/activate
python run_network_tax_single_device.py --protocol mqtt --duration 30 --num-sensors 100
```

### Full Experiment (60 seconds, 500 sensors)
```bash
source myenv/bin/activate
./run_network_tax_single.sh mqtt 60
```

### All Protocols
```bash
source myenv/bin/activate
python run_network_tax_single_device.py --all-protocols --duration 60
```

## Verification
The script now runs successfully through all three scenarios:
- ✅ Scenario A: No emulation (baseline)
- ✅ Scenario B: LAN emulation (1ms latency)
- ✅ Scenario C: WAN emulation (150ms latency + 1% loss)

## Notes
- **Sudo required**: Network emulation on loopback requires sudo privileges
- **Virtual environment**: Always activate `myenv` before running
- **Duration**: Reduce `--duration` and `--num-sensors` for faster testing
- **Results**: Saved in `results/network_tax_single_device/`
